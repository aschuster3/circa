{% extends 'base.html' %}
{% load static %}
{% block head_block %}
    <style>
        body {
            padding-top: 70px;
        }
    </style>

    <script text="text/javascript">
        function calc_time_left(end, display) {
            var time_left = end - (Date.now() / 1000.0);
            var displayText;

            if(time_left > 0) {
                // We only care about hours left
                time_left = time_left / 3600.0;
                if(time_left < 1){
                    //less than an hour left, display minutes
                    time_left = time_left * 60.0;
                    time_left = Math.floor(time_left);
                    displayText = time_left + " minutes";
                    }
                else {
                    time_left = Math.floor(time_left);
                    displayText = time_left + " hours";
                    }
            } else {
                displayText = "None";
            }
            display.textContent = displayText
        }
        window.onload = function () {
        var display;
        {% for item in items %}
            display = document.querySelector("#time_left{{ item.listing.id }}");
            {% if item.listing.end_date %}
                calc_time_left({{ item.listing.end_date|date:"U" }}, display);
            {% endif %}
        {% endfor %}
    };
    </script>
    <link href="{% static 'css/jumbotron-narrow.css'%}" rel="stylesheet" media="screen">

{% endblock %}
{% block nav_block %}
    <nav class="navbar navbar-inverse navbar-fixed-top">
{% endblock %}
{% block body_block %}
        <div class="container">
        {% if items %}
        {% load cropping %}
        <div class="take-space"></div>
        <div class="row">
            {% for item in items %}
            <div class="col s12 m6 l4">
                <div class="card medium">
                    <a href="/listing/{{ item.listing.id }}">
                        <div id="get-faded" class="card-image">
                            <img src="{% cropped_thumbnail item "cropping" width=150 %}">
                        </div>
                    </a>
                    <div class="card-content activator">
                        <h5 class="black-text truncate">{{ item.title }}</h5>
                        <p> {% if item.listing.current_offer %}
                            Current Offer: <strong>${{ item.listing.current_offer }}</strong>
                            {% else %}
                            Asking price: <strong>${{ item.listing.starting_offer }}</strong>
                            {% endif %}<br>
                            Buy Now: ${{ item.listing.buy_now_price }}<br>
                            {% if item.listing.current_offer %}
                            Time Left: <span id="time_left{{ item.listing.id }}" class="red-text">XX min</span>
                            {% endif %}
                        <i class="activator right">more</i></p>
                    </div>
                    <div class="card-reveal">
                        <span class="card-title grey-text text-darken-4">{{ item.title|truncatechars:40 }}</span>
                        <p>{{ item.description }}</p>
                        <a href="/listing/{{ item.listing.id }}" class="waves-effect waves-light btn">See Listing</a>
                    </div>
                </div>
            </div>
            {% endfor %}
        {% else %}
        <h2>This is awkward...there's nothing for sale! Why don't you <a href="/sell/">sell something</a>?</h2>
        {% endif %}
    </div>


{% endblock %}