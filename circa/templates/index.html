{% extends 'base.html' %}
{% load static %}
{% block head_block %}
    <style>
        body {
            padding-top: 70px;
        }
    </style>
    <script text="text/javascript">
        function calc_time_left(end, display) {
            var time_left = end - (Date.now() / 1000.0);
            var displayText;

            if(time_left > 0) {
                // We only care about hours left
                time_left = time_left / 3600.0;
                if(time_left < 1){
                    //less than an hour left, display minutes
                    time_left = time_left * 60.0;
                    time_left = Math.floor(time_left);
                    displayText = time_left + " minutes";
                    }
                else {
                    time_left = Math.floor(time_left);
                    displayText = time_left + " hours";
                    }
            } else {
                displayText = "None";
            }
            display.textContent = displayText
        }
        window.onload = function () {
        var display;
        {% for item in items %}
            display = document.querySelector("#time_left{{ item.auction.id }}");
            calc_time_left({{ item.auction.end_date|date:"U" }}, display);
        {% endfor %}
    };
    </script>
{% endblock %}
{% block nav_block %}
<nav class="navbar navbar-inverse navbar-fixed-top">


{% endblock %}
{% block body_block %}
    {%  if items %}
    {% load cropping %}
    <div class = "container">
        <div class = "list-group">
            {% for item in items %}
                    <div class="panel panel-info">
                        <div class = "panel-heading">
                            <h3 class = "panel-title"><a href="/auction/{{item.auction.id}}">{{item.title}}</a></h3>
                        </div>
                        <div class = "panel-body">
                            <div class = "panel-info">
                                <div class="row">
                                    <div class="col-xs-7 col-md-2">
                                        <a href="/auction/{{item.auction.id}}" class="thumbnail">
                                             <img src="{% cropped_thumbnail item "cropping" scale=0.444 %}" alt="...">
                                         </a>
                                     </div>
                                     <div class="col-xs-0 col-md-7">
                                       <span class = "hidden-xs"> {{ item.description|linebreaks }}</span>
                                      </div>
                                      <div class ="col-xs-5 col-md-3">
                                       Current Bid: <strong>${{ item.auction.current_bid }}</strong>
                                       <br>
                                       Buy now for: <strong>${{ item.auction.buy_now_price }}</strong>
                                      <br>
                                       Time Left: <strong><span id="time_left{{ item.auction.id }}"></span></strong>
                                       </div>

                                </div>
                            </div>
                        </div>


                    </div>

            {% endfor %}
        </div>
        {% else %}
            <h2>This is awkward...there's nothing for sale!</h2>
    {% endif %}
    </div>


{% endblock %}