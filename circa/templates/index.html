{% extends 'base.html' %}
{% load static %}
{% block head_block %}
    

    <script text="text/javascript">
        function calc_time_left(end, display) {
            var time_left = end - (Date.now() / 1000.0);
            var displayText;

            if(time_left > 0) {
                // We only care about hours left
                time_left = time_left / 3600.0;
                if(time_left < 1){
                    //less than an hour left, display minutes
                    time_left = time_left * 60.0;
                    time_left = Math.floor(time_left);
                    displayText = time_left + " minutes";
                    }
                else {
                    time_left = Math.floor(time_left);
                    displayText = time_left + " hours";
                    }
            } else {
                displayText = "None";
            }
            display.textContent = displayText
        }
        window.onload = function () {
        var display;
        {% for item in items %}
            display = document.querySelector("#time_left{{ item.listing.id }}");
            {% if item.listing.end_date %}
                calc_time_left({{ item.listing.end_date|date:"U" }}, display);
            {% endif %}
        {% endfor %}
    };
    </script>
    <link href="{% static 'css/jumbotron-narrow.css'%}" rel="stylesheet" media="screen">

{% endblock %}

{% block body_block %}
        <div class = "container">
            {% if not user.id %}
                <div class="jumbotron">
                    <h1>Buy and Sell at GT</h1>
                    <p>Circa makes buying and selling electronics around Georgia Tech easy. No more haggling, giving contact info to
                strangers, awkward meetups, or getting scammed. Scroll down to begin shopping.</p>
                    <p><a class="btn btn-primary btn-lg" href="/about" role="button">Learn more</a></p>
                </div>
                <br>
            {% endif %}
            {%  if items %}
            {% load cropping %}

            <div class = "list-group">
                {% for item in items %}
                        <div class="panel panel-info">
                            <div class = "panel-heading">
                                <h3 class = "panel-title"><a href="/listing/{{item.listing.id}}">{{item.title}}</a></h3>
                            </div>
                            <div class = "panel-body">
                                <div class = "panel-info">
                                    <div class="row">
                                        <div class="col-xs-7 col-md-2">
                                            <a href="/listing/{{item.listing.id}}" class="thumbnail">
                                                 <img src="{% cropped_thumbnail item "cropping" scale=0.444 %}" alt="...">
                                             </a>
                                         </div>
                                         <div class="col-xs-0 col-md-7">
                                           <span class = "hidden-xs"> {{ item.description|linebreaks }}</span>
                                          </div>
                                          <div class ="col-xs-5 col-md-3">
                                           {% if item.listing.current_offer %}
                                           Current Offer: <strong>${{ item.listing.current_offer }}</strong>
                                           {% else %}
                                           Asking price: <strong>${{ item.listing.starting_offer }}</strong>
                                           {% endif %}
                                           <br>
                                           Buy now for: <strong>${{ item.listing.buy_now_price }}</strong>
                                          <br>
                                            {% if item.listing.end_date %}
                                            Time Left: <strong><span id="time_left{{ item.listing.id }}"></span></strong>
                                            {% endif %}
                                          </div>

                                    </div>
                                </div>
                            </div>


                        </div>

                {% endfor %}
            </div>
            {% else %}
                <h2>This is awkward...there's nothing for sale! Why don't you <a href="/sell/">sell something</a>?</h2>
        {% endif %}
        </div>


{% endblock %}